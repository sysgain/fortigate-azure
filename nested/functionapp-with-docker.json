{  
    "$schema":"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion":"1.0.0.0",
    "parameters":{  
        "AzureFunction":{
            "type": "object"
        }
    },
    "variables":{  
    },
    "resources":[  
       {  
          "type":"Microsoft.Storage/storageAccounts",
          "apiVersion":"[parameters('AzureFunction').storageAccountsApiVersion]",
          "name":"[parameters('AzureFunction').storageName]",
          "location":"[resourceGroup().location]",
          "kind":"[parameters('AzureFunction').storageAccountKind]",
          "sku":{  
             "name":"[parameters('AzureFunction').storageAccountType]"
          }
       },
       {  
          "type":"Microsoft.Web/serverfarms",
          "apiVersion":"[parameters('AzureFunction').WebHostingApiVersion]",
          "name":"[parameters('AzureFunction').appServicePlanName]",
          "location":"[resourceGroup().location]",
          "sku":{  
             "Tier":"[parameters('AzureFunction').appServicePlanSku]",
             "Name":"[parameters('AzureFunction').appServicePlanSkuCode]"
          },
          "kind":"[parameters('AzureFunction').WebHostingkind]",
          "properties":{  
             "name":"[parameters('AzureFunction').appServicePlanName]",
             "workerSize":"[parameters('AzureFunction').workerSize]",
             "workerSizeId":"[parameters('AzureFunction').workerSizeId]",
             "numberOfWorkers":"[parameters('AzureFunction').numberOfWorkers]",
             "reserved":"[parameters('AzureFunction').reserved]",
             "hostingEnvironment":"[parameters('AzureFunction').hostingEnvironment]"
          }
       },
       {  
          "apiVersion":"[parameters('AzureFunction').WebSitesApiVersion]",
          "type":"Microsoft.Web/sites",
          "name":"[parameters('AzureFunction').functionAppName]",
          "location":"[resourceGroup().location]",
          "kind":"[parameters('AzureFunction').WebSiteskind]",
          "dependsOn":[  
             "[resourceId('Microsoft.Web/serverfarms', parameters('AzureFunction').appServicePlanName)]",
             "[resourceId('Microsoft.Storage/storageAccounts', parameters('AzureFunction').storageName)]"
          ],
          "properties":{  
             "serverFarmId":"[resourceId('Microsoft.Web/serverfarms', parameters('AzureFunction').appServicePlanName)]",
             "siteConfig":{  
                "appSettings":[  
                   {  
                      "name":"AzureWebJobsStorage",
                      "value":"[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('AzureFunction').storageName, ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('AzureFunction').storageName), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0]).keys[0].value)]"
                   },
                   {  
                      "name":"FUNCTIONS_WORKER_RUNTIME",
                      "value":"[parameters('AzureFunction').functionWorkerRuntime]"
                   },
                   {  
                      "name":"WEBSITE_NODE_DEFAULT_VERSION",
                      "value":"[parameters('AzureFunction').webSiteNodeDefaultVersion]"
                   },
                   {  
                      "name":"FUNCTIONS_EXTENSION_VERSION",
                      "value":"[parameters('AzureFunction').functionExtensionVersion]"
                   },
                   {  
                      "name":"DOCKER_REGISTRY_SERVER_URL",
                      "value":"[parameters('AzureFunction').dockerRegistryURL]"
                   },
                   {  
                      "name":"DOCKER_REGISTRY_SERVER_USERNAME",
                      "value":"[parameters('AzureFunction').dockerRegistryUser]"
                   },
                   {  
                      "name":"DOCKER_REGISTRY_SERVER_PASSWORD",
                      "value":"[parameters('AzureFunction').dockerRegistryPassword]"
                   },
                   {  
                      "name":"WEBSITES_ENABLE_APP_SERVICE_STORAGE",
                      "value":"[parameters('AzureFunction').appServiceStroage]"
                   }
                ],
                "linuxFxVersion":"[parameters('AzureFunction').linuxFxVerison]"
             }
          }
       }
    ]
 }
