{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "azureFunction": {
            "type": "object"
        },
        "storageAccount":{
            "type": "object"
        },
        "workloadsSettings":{
            "type": "object"
        },
        "existingVNetName":{
            "type": "string"
        },
        "existingSubnetName":{
            "type": "string"
        }
    },
    "variables": {
    },
    "resources": [
        {
            "apiVersion": "2016-03-01",
            "type": "Microsoft.Web/sites",
            "name": "[parameters('azureFunction').functionAppName]",
            "location": "West Europe",
            "kind": "functionapp,linux",
            "properties": {
                "name": "[parameters('azureFunction').functionAppName]",
                "clientAffinityEnabled": false,
                "reserved": true,
                "siteConfig": {
                    "appSettings": [
                        {
                            "name": "FUNCTIONS_WORKER_RUNTIME",
                            "value": "python"
                        },
                        {
                            "name": "AzureWebJobsStorage",
                            "value": "[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageAccount').storageAccountName,';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts',parameters('storageAccount').storageAccountName), '2015-05-01-preview').key1)]"
                        },
                        {
                            "name": "FUNCTIONS_EXTENSION_VERSION",
                            "value": "~2"
                        },
                        {
                            "name": "WEBSITE_NODE_DEFAULT_VERSION",
                            "value": "10.14.1"
                        },
                        {
                            "name":"virtualMachineName1",
                            "value": "[parameters('workloadsSettings').virtualMachineName1]"
                        },
                        {
                            "name":"nicName1",
                            "value": "[parameters('workloadsSettings').nicName1]"
                        },
                        {
                            "name":"networkSecurityGroupName",
                            "value": "[parameters('workloadsSettings').networkSecurityGroupName]"
                        },
                        {
                            "name":"osDiskName1",
                            "value": "[parameters('workloadsSettings').osDiskName1]"
                        },
                        {
                            "name":"virtualNetworkName",
                            "value": "[parameters('existingVNetName')]"
                        },
                        {
                            "name":"routeTableName",
                            "value": "[parameters('workloadsSettings').routeTableName]"
                        },
                        {
                            "name":"subnetName1",
                            "value": "[parameters('existingSubnetName')]"
                        },
                        {
                            "name":"to-InternetDefaultRoute",
                            "value": "to-InternetDefaultRoute"
                        },
                        {
                            "name":"RGName",
                            "value": "[resourceGroup().name]"
                        },
                        {
                            "name": "AppID",
                            "value": "[parameters('workloadsSettings').clientID]"
                        },
                        {
                            "name": "AppPassword",
                            "value": "[parameters('workloadsSettings').ClientSecret]"
                        },
                        {
                            "name": "TenantID",
                            "value": "[parameters('workloadsSettings').tenantID]"
                        },
                        {
                            "name":"SubscriptionID",
                            "value": "[parameters('workloadsSettings').subscriptionID]"
                        }
                    ]
                }
            }
        }
    ]
}
