{  
    "$schema":"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion":"1.0.0.0",
    "parameters":{  
       "AzureFunction":{  
          "type":"object"
       },
       "workloadsSettings":{  
          "type":"object"
       },
       "wlNetworkSettings":{  
          "type":"object"
       }
    },
    "variables":{},
    "resources":[  
       {  
          "apiVersion":"[parameters('AzureFunction').WebSitesApiVersion]",
          "type":"Microsoft.Web/sites",
          "name":"[parameters('AzureFunction').functionAppName1]",
          "location":"[resourceGroup().location]",
          "kind":"[parameters('AzureFunction').WebSiteskind]",
          "properties":{  
             "serverFarmId":"[resourceId('Microsoft.Web/serverfarms', parameters('AzureFunction').appServicePlanName)]",
             "siteConfig":{  
                "appSettings":[  
                   {  
                      "name":"AzureWebJobsStorage",
                      "value":"[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('AzureFunction').storageName, ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('AzureFunction').storageName), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0]).keys[0].value)]"
                   },
                   {  
                      "name":"FUNCTIONS_WORKER_RUNTIME",
                      "value":"[parameters('AzureFunction').functionWorkerRuntime]"
                   },
                   {  
                      "name":"WEBSITE_NODE_DEFAULT_VERSION",
                      "value":"[parameters('AzureFunction').webSiteNodeDefaultVersion]"
                   },
                   {  
                      "name":"FUNCTIONS_EXTENSION_VERSION",
                      "value":"[parameters('AzureFunction').functionExtensionVersion]"
                   },
                   {  
                      "name":"DOCKER_REGISTRY_SERVER_URL",
                      "value":"[parameters('AzureFunction').dockerRegistryURL]"
                   },
                   {  
                      "name":"WEBSITES_ENABLE_APP_SERVICE_STORAGE",
                      "value":"[parameters('AzureFunction').appServiceStroage]"
                   },
                   {  
                      "name":"VmName1",
                      "value":"[parameters('workloadsSettings').virtualMachineName1]"
                   },
                   {  
                      "name":"VmName2",
                      "value":"[parameters('workloadsSettings').virtualMachineName2]"
                   },
                   {  
                      "name":"Nic1",
                      "value":"[parameters('workloadsSettings').nicName1]"
                   },
                   {  
                      "name":"Nic2",
                      "value":"[parameters('workloadsSettings').nicName2]"
                   },
                   {  
                      "name":"NSG",
                      "value":"[parameters('workloadsSettings').networkSecurityGroupName]"
                   },
                   {  
                      "name":"Disk1",
                      "value":"[parameters('workloadsSettings').osDiskName1]"
                   },
                   {  
                      "name":"Disk2",
                      "value":"[parameters('workloadsSettings').osDiskName2]"
                   },
                   {  
                      "name":"VNet",
                      "value":"[parameters('wlNetworkSettings').virtualNetworkName]"
                   },
                   {  
                      "name":"RouteTable",
                      "value":"[parameters('workloadsSettings').routeTableName]"
                   },
                   {  
                      "name":"Route",
                      "value":"to-InternetDefaultRoute"
                   },
                   {  
                      "name":"RGName",
                      "value":"[resourceGroup().name]"
                   },
                   {  
                      "name":"AppID",
                      "value":"[parameters('workloadsSettings').clientID]"
                   },
                   {  
                      "name":"AppPassword",
                      "value":"[parameters('workloadsSettings').ClientSecret]"
                   },
                   {  
                      "name":"TenantID",
                      "value":"[parameters('workloadsSettings').tenantID]"
                   },
                   {  
                      "name":"SubscriptionID",
                      "value":"[parameters('workloadsSettings').subscriptionID]"
                   },
                   {  
                      "name":"APPINSIGHTS_INSTRUMENTATIONKEY",
                      "value":"[reference(resourceId('microsoft.insights/components/', parameters('AzureFunction').appInsightsName), parameters('AzureFunction').appInsightsApiVersion).InstrumentationKey]"
                   }
                ],
                "linuxFxVersion":"[parameters('AzureFunction').linuxFxVersion1]" 
             }
          }
       }
    ]
 }
